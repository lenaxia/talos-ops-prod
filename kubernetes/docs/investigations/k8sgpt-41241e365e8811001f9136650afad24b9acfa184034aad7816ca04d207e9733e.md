# k8sgpt Investigation: 41241e365e8811001f9136650afad24b9acfa184034aad7816ca04d207e9733e

## Finding

- **Kind:** ValidatingWebhookConfiguration
- **Resource:** inteldeviceplugins-validating-webhook-configuration (webhook: vqatdeviceplugin.kb.io)
- **Namespace:** kube-system
- **k8sgpt fingerprint:** `41241e365e8811001f9136650afad24b9acfa184034aad7816ca04d207e9733e`

## Issue

k8sgpt reported that the ValidatingWebhookConfiguration for vqatdeviceplugin.kb.io is pointing to inactive receiver pods (inteldeviceplugins-controller-manager-6bd5cc95bf-2kzwj and inteldeviceplugins-controller-manager-6bd5cc95bf-r9kzv).

## Investigation Results

### Actual State

The webhook configuration is **correct and functioning properly**:

1. The ValidatingWebhookConfiguration `inteldeviceplugins-validating-webhook-configuration` contains a webhook named `vqatdeviceplugin.kb.io` that points to:
   - Service: `inteldeviceplugins-webhook-service` in namespace `kube-system`
   - Port: 443
   - Path: `/validate-deviceplugin-intel-com-v1-qatdeviceplugin`

2. The service endpoint correctly resolves to the active pod `inteldeviceplugins-controller-manager-c5b6f7964-krpsb` (IP: 10.69.5.77)

3. The EndpointSlice shows only the active pod as ready and serving

### Old Completed Pods

There are two old completed pods from a previous deployment revision:
- `inteldeviceplugins-controller-manager-6bd5cc95bf-2kzwj` (Completed, 70d old)
- `inteldeviceplugins-controller-manager-6bd5cc95bf-r9kzv` (Completed, 79d old)

These pods belong to ReplicaSet revision 3 (image 0.34.0), while the current deployment is on revision 4 (image 0.34.1).

### Root Cause

The k8sgpt finding appears to be a **false positive** caused by:

1. Old completed pods from a previous deployment revision were not automatically cleaned up
2. k8sgpt detected these old pods and incorrectly flagged the webhook as pointing to inactive receiver pods
3. In reality, the webhook points to a service that correctly resolves to the active pod

## Resolution

**No code changes required.** The webhook configuration is correct and working as expected.

**Recommended actions:**

1. Manually delete the old completed pods if they are not needed:
   ```bash
   kubectl delete pod inteldeviceplugins-controller-manager-6bd5cc95bf-2kzwj -n kube-system
   kubectl delete pod inteldeviceplugins-controller-manager-6bd5cc95bf-r9kzv -n kube-system
   ```

2. Consider adding a Pod GC policy or CronJob to periodically clean up completed pods from Deployments

## Confidence

**Medium** - The webhook configuration is confirmed to be correct and functional. The root cause of why old pods were not automatically cleaned up is not fully understood and may be expected behavior for the intel-deviceplugin-operator.
