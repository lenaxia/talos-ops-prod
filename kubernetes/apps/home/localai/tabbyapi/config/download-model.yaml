apiVersion: v1
kind: ConfigMap
metadata:
  name: download-model
  namespace: home
data:
  download_model.py: |
    #!/usr/bin/env python3
    import os
    from huggingface_hub import snapshot_download

    model_dir = os.environ.get("MODEL_DIR", "/app/models/Qwen2.5-72B-Instruct-exl2-4_25")
    repo_id = os.environ.get("REPO_ID", "bartowski/Qwen2.5-72B-Instruct-exl2")
    revision = os.environ.get("REVISION", "4_25")

    os.makedirs(model_dir, exist_ok=True)

    # Check if model already exists by looking for config.json
    if not os.path.exists(os.path.join(model_dir, "config.json")):
        print(f"Downloading model from {repo_id} (revision: {revision})...")
        print(f"Target directory: {model_dir}")
        
        # snapshot_download automatically shows progress bars and downloads ALL files
        snapshot_download(
            repo_id=repo_id,
            revision=revision,
            local_dir=model_dir
        )
        
        print("âœ“ All model files downloaded successfully")
    else:
        print("Model files found. Skipping download.")

